summary: data interchange format by Google
git-url: https://github.com/protocolbuffers/protobuf.git
src-url: https://github.com/protocolbuffers/protobuf/releases/download/v21.5/protobuf-all-21.5.tar.gz
src-sha: 7ba0cb2ecfd9e5d44a6fa9ce05f254b7e5cd70ec89fafba0b07448f3e258310c
license: BSD-3-Clause
dep-pkg: zlib

install: |
    # https://cmake.org/cmake/help/latest/variable/CMAKE_SKIP_INSTALL_RPATH.html
    if printf '%s\n' "$CMAKE_EXE_LINKER_FLAGS" | grep -q '\--static' ; then
        CMAKE_SKIP_INSTALL_RPATH=TRUE
    else
        CMAKE_SKIP_INSTALL_RPATH=FALSE
    fi

    cmakew \
        -DCMAKE_SKIP_INSTALL_RPATH="$CMAKE_SKIP_INSTALL_RPATH" \
        -Dprotobuf_BUILD_TESTS=OFF \
        -Dprotobuf_BUILD_EXAMPLES=OFF \
        -Dprotobuf_BUILD_SHARED_LIBS=OFF \
        -DZLIB_INCLUDE_DIR=$zlib_INCLUDE_DIR \
        -DZLIB_LIBRARY_RELEASE=$zlib_LIBRARY_DIR/libz.a
