summary: A general-purpose, portable utility library which provides many useful data types, macros, type conversions, string utilities, file utilities, a mainloop abstraction, and so on
web-url: https://developer.gnome.org/glib
git-url: https://github.com/GNOME/glib
src-url: https://download.gnome.org/sources/glib/2.82/glib-2.82.4.tar.xz
src-uri: https://distfiles.macports.org/glib2/glib-2.82.4.tar.xz
src-sha: 37dd0877fe964cd15e9a2710b044a1830fb1bd93652a6d0cb6b8b2dff187c709
license: LGPL-2.1-or-later
dep-pkg: libpcre2 libintl libffi libz
dep-upp: gettext-tools gm4 flex bison
dep-pym: packaging 'setuptools<65'
bsystem: meson

res-url: https://download.gnome.org/sources/gobject-introspection/1.82/gobject-introspection-1.82.0.tar.xz
res-uri: https://distfiles.macports.org/gobject-introspection/gobject-introspection-1.82.0.tar.xz
res-sha: 0f5a4c1908424bf26bc41e9361168c363685080fbdb87a196c891c8401ca2f09

install: |
    if isCrossBuild ; then
        mesonw \
            -Dintrospection=disabled \
            -Ddocumentation=false \
            -Dman-pages=disabled \
            -Dnls=disabled \
            -Ddtrace=false \
            -Dglib_debug=disabled \
            -Dglib_assert=false \
            -Dtests=false \
            -Dinstalled_tests=false \
            -Dbsymbolic_functions=false
    else
        (
            PACKAGE_BCACHED_DIR="$PACKAGE_WORKING_DIR/tmp/glib"
            PACKAGE_INSTALL_DIR="$PACKAGE_WORKING_DIR/tmp/out"

            export LDFLAGS="$LDFLAGS -Wl,-rpath,$PACKAGE_INSTALL_DIR/lib"

            mesonw \
                -Dintrospection=disabled \
                -Ddocumentation=false \
                -Dman-pages=disabled \
                -Dnls=disabled \
                -Ddtrace=false \
                -Dglib_debug=disabled \
                -Dglib_assert=false \
                -Dtests=false \
                -Dinstalled_tests=false \
                -Dbsymbolic_functions=false

            ###########################################################################

            export PKG_CONFIG_PATH="$PKG_CONFIG_PATH:$PACKAGE_INSTALL_DIR/lib/pkgconfig"

            PACKAGE_BSCRIPT_DIR="$PACKAGE_WORKING_DIR/res"
            PACKAGE_BCACHED_DIR="$PACKAGE_WORKING_DIR/tmp/gobject-introspection"
            PACKAGE_INSTALL_DIR="$PACKAGE_WORKING_DIR/tmp/out"

            mesonw
        )

        export PKG_CONFIG_PATH="$PKG_CONFIG_PATH:$PACKAGE_WORKING_DIR/tmp/out/lib/pkgconfig"
        export PATH="$PACKAGE_WORKING_DIR/tmp/out/bin:$PATH"

        mesonw \
            -Dintrospection=enabled \
            -Ddocumentation=false \
            -Dman-pages=disabled \
            -Dnls=disabled \
            -Ddtrace=false \
            -Dglib_debug=disabled \
            -Dglib_assert=false \
            -Dtests=false \
            -Dinstalled_tests=false \
            -Dbsymbolic_functions=false
    fi

dotweak: |
    gsed -i 's|libiconv|libintl libffi libz|' lib/pkgconfig/glib-2.0.pc

    if [ "$TARGET_PLATFORM_NAME" = macos ] ; then
        gsed -i 's|-lintl|-lresolv|g'         lib/pkgconfig/glib-2.0.pc
    fi
