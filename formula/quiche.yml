summary: Savoury implementation of the QUIC transport protocol and HTTP/3
git-url: https://github.com/cloudflare/quiche
src-url: https://github.com/cloudflare/quiche/archive/refs/tags/0.18.0.tar.gz
src-sha: eb242a14c4d801a90b57b6021dd29f7a62099f3a4d7a7ba889e105f8328e6c1f
license: BSD-2-Clause
bsystem: cargo cmake
dopatch: |
    GIT_FETCH_URL='https://github.com/google/boringssl'

    if [ -n "$PPKG_URL_TRANSFORM" ] ; then
        GIT_FETCH_URL="$("$PPKG_URL_TRANSFORM" "$GIT_FETCH_URL")"
    fi

    run git -C quiche/deps clone --depth=1 "$GIT_FETCH_URL"
install: |
    cargow build --package quiche &&
    install_incs quiche/include/quiche.h &&
    install_libs target/$RUST_TARGET/release/libquiche.a &&
    install_libs target/$RUST_TARGET/release/libquiche$SHARED_LIBRARY_SUFFIX
