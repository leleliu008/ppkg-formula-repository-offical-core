summary: Command-line outline and bitmap font editor/converter
web-url: https://fontforge.github.io
git-url: https://github.com/fontforge/fontforge.git
src-url: https://github.com/fontforge/fontforge/releases/download/20220308/fontforge-20220308.tar.xz
src-sha: 01e4017f7a0ccecf436c74b8e1f6b374fc04a5283c1d68967996782e15618e59
license: GPL-3.0-or-later
dep-pkg: pango libuninameslist libspiro giflib libjpeg-turbo libtiff
prepare: |
    cat > cmake/packages/FindTIFF.cmake <<EOF
    # https://cmake.org/cmake/help/latest/module/FindTIFF.html
    #
    # try to find tiff.h and libtiff.a|so|dylib, once done following variables will be defined
    #
    # TIFF_FOUND         - libtiff.a|so|dylib have been found
    # TIFF_INCLUDE_DIR   - the libtiff include directory
    # TIFF_INCLUDE_DIRS  - the libtiff and dependencies include directory
    # TIFF_LIBRARIES     - the filepath of libtiff.a|so|dylib and it's dependencies


    if (TIFF_INCLUDE_DIRS AND TIFF_LIBRARIES)
        set(TIFF_FOUND TRUE)
    else()
        pkg_check_modules(PKG_CONFIG_LIBTIFF QUIET libtiff-4)

        message("PKG_CONFIG_LIBTIFF_FOUND=\${PKG_CONFIG_LIBTIFF_FOUND}")
        message("PKG_CONFIG_LIBTIFF_INCLUDE_DIRS=\${PKG_CONFIG_LIBTIFF_INCLUDE_DIRS}")
        message("PKG_CONFIG_LIBTIFF_LIBRARY_DIRS=\${PKG_CONFIG_LIBTIFF_LIBRARY_DIRS}")
        message("PKG_CONFIG_LIBTIFF_INCLUDEDIR=\${PKG_CONFIG_LIBTIFF_INCLUDEDIR}")
        message("PKG_CONFIG_LIBTIFF_LIBDIR=\${PKG_CONFIG_LIBTIFF_LIBDIR}")
        message("PKG_CONFIG_LIBTIFF_VERSION=\${PKG_CONFIG_LIBTIFF_VERSION}")
        message("PKG_CONFIG_LIBTIFF_LIBRARIES=\${PKG_CONFIG_LIBTIFF_LIBRARIES}")
        message("PKG_CONFIG_LIBTIFF_LINK_LIBRARIES=\${PKG_CONFIG_LIBTIFF_LINK_LIBRARIES}")
        message("PKG_CONFIG_LIBTIFF_STATIC_LIBRARIES=\${PKG_CONFIG_LIBTIFF_STATIC_LIBRARIES}")
        message("PKG_CONFIG_LIBTIFF_STATIC_LINK_LIBRARIES=\${PKG_CONFIG_LIBTIFF_STATIC_LINK_LIBRARIES}")

        if (PKG_CONFIG_LIBTIFF_FOUND)
            if (PKG_CONFIG_LIBTIFF_INCLUDE_DIRS)
                set(TIFF_INCLUDE_DIRS "\${PKG_CONFIG_LIBTIFF_INCLUDE_DIRS}")
            elseif (PKG_CONFIG_LIBTIFF_INCLUDEDIR)
                set(TIFF_INCLUDE_DIRS "\${PKG_CONFIG_LIBTIFF_INCLUDEDIR}")
            else()
                find_path(TIFF_INCLUDE_DIRS tiff.h)
            endif()

            # https://sourceware.org/bugzilla/show_bug.cgi?id=21264

            set(TIFF_LIBRARIES )

            foreach(item \${PKG_CONFIG_LIBTIFF_LINK_LIBRARIES})
                    if(item MATCHES ".*libm\\.a")
                elseif(item MATCHES ".*libdl\\.a")
                elseif(item MATCHES ".*librt\\.a")
                elseif(item MATCHES ".*libpthread\\.a")
                else()
                    get_filename_component(LIBRARIE_FILENAME \${item} NAME)

                    message(STATUS "\${LIBRARIE_FILENAME}")

                    if (NOT TARGET  TIFF::\${LIBRARIE_FILENAME})
                        add_library(TIFF::\${LIBRARIE_FILENAME} UNKNOWN IMPORTED)
                        set_target_properties(TIFF::\${LIBRARIE_FILENAME} PROPERTIES IMPORTED_LOCATION "\${item}")
                    endif()

                    list(APPEND TIFF_LIBRARIES TIFF::\${LIBRARIE_FILENAME})
                endif()
            endforeach()

            if (NOT TARGET  TIFF::TIFF)
                add_library(TIFF::TIFF INTERFACE IMPORTED)
                set_target_properties(TIFF::TIFF PROPERTIES
                    INTERFACE_INCLUDE_DIRECTORIES "\${TIFF_INCLUDE_DIRS}"
                    INTERFACE_LINK_LIBRARIES      "\${TIFF_LIBRARIES}"
                )
            endif()
        endif()
    endif()

    include(FindPackageHandleStandardArgs)
    find_package_handle_standard_args(TIFF REQUIRED_VARS TIFF_LIBRARIES TIFF_INCLUDE_DIRS VERSION_VAR TIFF_VERSION)

    mark_as_advanced(TIFF_INCLUDE_DIRS TIFF_LIBRARIES)
    EOF

install: |
    cmakew \
        -DENABLE_GUI=OFF \
        -DENABLE_FONTFORGE_EXTRAS=ON
