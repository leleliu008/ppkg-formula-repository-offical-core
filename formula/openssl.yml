summary: Cryptography and SSL/TLS Toolkit
web-url: https://www.openssl.org/
src-url: https://www.openssl.org/source/openssl-3.0.5.tar.gz
src-sha: aa7d8d9bef71ad6525c55ba11e5f4397889ce49c2c9349dcea6d3e4f0b024a7a
git-url: https://github.com/openssl/openssl
dep-pkg: perl
license: Apache-2.0

bsystem: gmake
binbstd: yes
install: |
    case $NATIVE_OS_KIND in
        openbsd) sed -i 's|-Wl,-z,defs||' Configurations/shared-info.pl
    esac

    if printf '%s\n' "$LDFLAGS" | grep -q '\-static' ; then
        export LDFLAGS="$(printf '%s\n' "$LDFLAGS" | sed -e 's|--static||g' -e 's|-static||g')"
        #sed_in_place 's|BIN_EX_LIBS=|BIN_EX_LIBS=-static |' Configurations/unix-Makefile.tmpl
    fi

    if [ "$LINK_TYPE" = static-only ] || [ "$LINK_TYPE" = static-prefered ] ; then
        export LDCMD=./build-openssl-cmd.sh

        cat > "$LDCMD" <<EOF
        #!/bin/sh
        $CC \$(printf '%s\n' "\$*" | sed -e 's|-lssl|./libssl.a|g' -e 's|-lcrypto|./libcrypto.a|g')
    EOF

        chmod +x "$LDCMD"
    fi

    run ./config \
        no-engine \
        no-tests \
        no-ssl2 \
        no-ssl3 \
        no-comp \
        no-asm \
        no-hw \
        --prefix=$PACKAGE_INSTALL_DIR  \
        --libdir=$PACKAGE_INSTALL_DIR/lib &&
    gmakew clean &&
    gmakew &&
    gmakew install
